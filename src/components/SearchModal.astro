---
//@ts-nocheck
import { Icon } from 'astro-icon/components'

const { allPosts } = Astro.props

---
<div id="search-modal" class="modal">
  <div class="modal-background"></div>

  <div class="modal-content">
    <div class="card">
        <div class="card-content">
            <header class="search-card-header">
                <div class="search-input control has-icons-left">
                    <input class="input " id="search-input" placeholder="Search">
                    <span class="icon is-left">
                        <Icon name="fa7-solid:search" />
                    </span>
                </div>
                <button style="margin-left: 10px;" type="button" class="delete" id="clear-input"/>
            </header>
            <section>
                <br>
                <div class="panel">
                    {allPosts.map(post =>  
                        <a class="panel-block" href={'/posts/'+ post.id}>{new Date(post.data.date).toDateString()} - {post.data.title}</a>
                    )}
                </div>
            </section>
        </div>
    </div>
  </div>

  <button class="modal-close is-large" aria-label="close"></button>
</div>

<style>

/*  .modal-card-body {
    color: black;
  }*/

/*  .panel-block:hover {
    color: lightgray;
  } */

  .search-card {
    max-height: 75vh;
  }

  .search-card-header {
    display: flex;
    flex-shrink: 0;
    align-items: center;
  }

  .search-input {
    width: 100%
  }

</style>

<script>
    //@ts-nocheck
    import {getPureText} from '../scripts/misc'


    // Code from Bulma site to implement js modal features
    document.addEventListener('DOMContentLoaded', () => {
        // Functions to open and close a modal
        function openModal($el) {
            $el.classList.add('is-active');
            document.getElementById("search-input").focus()
        }

        function closeModal($el) {
            $el.classList.remove('is-active');
        }

        function closeAllModals() {
            (document.querySelectorAll('.modal') || []).forEach(($modal) => {
            closeModal($modal);
            });
        }

        // Add a click event on buttons to open a specific modal
        (document.querySelectorAll('.js-modal-trigger') || []).forEach(($trigger) => {
            const modal = $trigger.dataset.target;
            const $target = document.getElementById(modal);

            $trigger.addEventListener('click', () => {
            openModal($target);
            });
        });

        // Add a click event on various child elements to close the parent modal
        (document.querySelectorAll('.modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button') || []).forEach(($close) => {
            const $target = $close.closest('.modal');

            $close.addEventListener('click', () => {
            closeModal($target);
            });
        });

        // Add a keyboard event to close all modals
        document.addEventListener('keydown', (event) => {
            if(event.key === "Escape") {
            closeAllModals();
            }
        });
    });

    const clearInputButton = document.getElementById('clear-input')
    const searchElement = document.getElementById('search-input')
    const itemElements = document.getElementsByClassName('panel-block')

    clearInputButton.addEventListener('click', () => {
        searchElement.value = ''
        searchElement.dispatchEvent(new Event('input'))
    })

    searchElement.addEventListener('input', function() {
        Array.from(itemElements).forEach(item => {
            if (getPureText(item.innerText).includes(getPureText(searchElement.value))) {
                item.classList.remove('is-hidden')
            } else {
                item.classList.add('is-hidden')
            }
        })
    })

</script>