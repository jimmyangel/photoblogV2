---
import "@splidejs/splide/css"
import { Splide, SplideSlide } from 'astro-splide'

import { getCollection, render } from 'astro:content'

import { Picture } from 'astro:assets'

import BaseLayout from '../../layouts/BaseLayout.astro'

export async function getStaticPaths() {
  const posts = await getCollection('posts')
  return posts.map(post => ({
    params: { slug: post.id }, props: { post },
  }))
}

const { post } = Astro.props
const { Content } = await render(post)

---

<BaseLayout>
  <div class="section container is-max-desktop">
      <div class="has-text-centered">
        {post.data.title}<br>
        <small>{new Date(post.data.date).toLocaleString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</small>
      </div>
      <br>

      <Splide
        class='not-content'
        options={ { 
          type: 'loop', 
          autoplay: false,
          arrows: post.data.photos.length > 1
        } }
      >

    {post.data.photos.map(photo => 
      <SplideSlide>
        <figure>
          <div class="image">
            <Picture src={photo.photourl} alt={photo.photocaption} layout='constrained' width={1920}/>
          </div>
          <figcaption class="has-text-centered is-size-5">
            <br>
            {photo.photocaption}
            <br><br>
          </figcaption>
        </figure>
      </SplideSlide>
    )}
  </div>

  <div class="section container is-max-desktop">
    <Content />
  </div>

</BaseLayout>

<style>
  .content {
    padding-left: 2rem;
    padding-right: 2rem;
  }

  .section {
    padding-top: 1rem;
    padding-bottom: 0.5rem;
  }
</style>

